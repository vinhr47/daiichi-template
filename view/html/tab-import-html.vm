#set( $dataFields = $entity.getAttributesByCriteria( $const.NOT_KEY, $const.NOT_IN_SELECTED_LINKS) )
#set( $entityLC = $fn.toLowerCase($entity.name))
#set( $nameLC = ${entity.name.toLowerCase()} )
#set( $uncapitalizedEntityName = $fn.uncapitalize($entity.name) )
#set( $halfSizeFields = ($fn.size($dataFields) - 8 )/2)
#set( $countField = 0)
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<body>	
<div class="bg-content clearfix">
	<form class="form-horizontal j-formSearch" id="fmUpload" method="POST" role="form" enctype="multipart/form-data">
		<div class="row">

			<div class="col-xs-12 col-sm-12 no-padding" style="margin-top: 10px;">
				<div class="form-group">
					<div class="col-xs-12 col-sm-12">
						<div class="col-sm-2">
							<label th:text="#{${entityLC}.import.excel}"></label>
						</div>
						<div class="col-sm-8">
							<input id="template-upload" type="file" name="files"
												accept="application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" class="upload" />
						</div>
					</div>
				</div>
			</div>


			<div id="form-download-template" class="col-xs-12 col-sm-12">
				<div class="form-group">
					<div class="col-xs-12 col-sm-12 no-padding">
						<div class="col-sm-2">
							<label th:text="#{${entityLC}.file.import}">Template Import</label>
						</div>
						<div class="col-sm-8">
							<a th:href="@{${'/'+ $fn.toLowerCase($entity.name) + T(vn.com.unit.jcanary.constant.UrlConst).URL_DOWNLOAD_TEMPLATE_EXCEL}}"
								id="download-template-id"> Download Template</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>
</div>
<div class="bg-content clearfix">
	<div data-toggle="collapse" data-target="#import-result" class="header-box" aria-expanded="true">
		<h2 class="title-box" th:text="#{${entityLC}.import.result}"></h2>
			<i class="fa fa-minus pull-right" aria-hidden="true"></i>
	</div>
	<div class="col-sm-12 no-padding">
		<div class="section-wrap">
			<div class="table-responsive">
				<table id="data" class="table table-bordered table-striped">
					<thead>
						<tr>
							<th class="u_t_no text-center" th:text="#{common.import.row}">Row<a href="javascript:void(0)" class="pull-right"><i class="fa fa-sort sort sort-rownum" aria-hidden="true"></i></a></th>
                            <th class="u_t_no text-center"><span th:text="#{common.import.message.error}"></span><a href="javascript:void(0)" class="pull-right"><i class="fa fa-sort sort sort-message" aria-hidden="true"></i></a></th>
#foreach( $field in $dataFields )
#if($field.formattedName(0) != 'deletedBy' && $field.formattedName(0) != 'deletedDate' && $field.formattedName(0) != 'createdBy'
&& $field.formattedName(0) != 'createdDate' && $field.formattedName(0) != 'updatedDate' && $field.formattedName(0) != 'updatedBy'
&& $field.formattedName(0) != 'deleteFlag' && $field.formattedName(0) != 'validFlag' && $field.formattedName(0) != 'companyCode')	
			   			<th class="u_t_code" th:text="#{${entityLC}.${field.formattedName(0)}}">$fn.toUpperCase($field.formattedName(0))</th>
 #end	
 #end	
                            
						</tr>
					</thead>
					<tbody>
						<th:block th:each="item, i : ${DOLLAR}{pageWrapper.data}" th:with="startIndex=${DOLLAR}{pageWrapper.startIndexCurrent}">
							<tr th:attr="data-temp-id=${DOLLAR}{item.id}">
								<td class="text-center" th:text="${DOLLAR}{item.rowNum}"></td>
                                <td class="text-center">
                                	<th:block th:if="${DOLLAR}{item.messageType == 2}"> 
                               	 		<span class="message-error" th:text="#{${DOLLAR}{item.messageErrorCode} }"></span> 
                               	 	</th:block>
                               	 	<th:block th:if="${DOLLAR}{item.messageType == 1}"> 
                               	 		<span class="message-warning" th:text="#{${DOLLAR}{item.messageErrorCode} }"></span> 
                               	 	</th:block>
                               	 	<th:block th:if="${DOLLAR}{item.messageType != 1 AND item.messageType != 2}"> 
                               	 		<span></span> 
                               	 	</th:block>
                                </td>
		#foreach( $field in $dataFields )
#if($field.formattedName(0) != 'deletedBy' && $field.formattedName(0) != 'deletedDate' && $field.formattedName(0) != 'createdBy'
&& $field.formattedName(0) != 'createdDate' && $field.formattedName(0) != 'updatedDate' && $field.formattedName(0) != 'updatedBy'
&& $field.formattedName(0) != 'deleteFlag' && $field.formattedName(0) != 'validFlag' && $field.formattedName(0) != 'companyCode')
		#if($field.jdbcTypeName == 'TIMESTAMP')
		<td class="text-center" th:text="${DOLLAR}{item.${field.formattedName(0)}} ? ${DOLLAR}{#dates.format(item.${field.formattedName(0)}, @menuConfig.getFormDate())}"></td>
		#else	
		<td th:text="${DOLLAR}{item.${field.formattedName(0)}}">$fn.toUpperCase($field.formattedName(0))</td>
		#end
		#end
		#end	
							</tr>
						</th:block>
					</tbody>
				</table>
			</div>
			<th:block th:include="views/commons/pagination.html :: content" />
			<div class="col-sm-12 text-center" style="margin-top: 10px; margin-bottom: 10px;">
				<a id="import" onclick="importToMasterData()" class="btn-common"><span th:text="#{common.import.button}">Import</span></a>
			</div>
		</div>
	</div>

</div>
<script> 
$('#fmUpload').fileupload({
    url: '',
    type: 'POST',
    dataType: 'json',
    formAcceptCharset: 'utf-8',
    limitMultiFileUploadSize: 1000000,
    limitMultiFileUploadSizeOverhead: 1000000,
    multipart: true,
    maxChunkSize :10000000,
    sequentialUploads: false, 
    add: function (e, data) {
    	$('#btnImport').click(function(e) {
    		e.preventDefault(e);
    		if(data.files != null){
    		   //Disable submit button
    		   $('#btnImport').addClass('hidden');

    		   	if(data != null){
    		   		data.url= BASE_URL + $('#linkUploadExcelCommon').val();
        			data.submit();
    		   	}	
    			
    			data.files = null;
    		
			}
        });
    },
	done: function (e, data) {
		
		var response = data.result;
		$("#message-inprocess").html('<span class="text-center" style="color:green;">'+ 'Process completed'+'<span/>');
    	$('#btnImport').removeClass('hidden');
    	$('.message-file-upload').remove();
    
    	if(response.result=='success'){
		      var linkUploadList = $("#linkUploadExcelListCommon").val();     		 
     		  if(linkUploadList.indexOf("?") !== -1){
     			 window.location.href = BASE_URL + linkUploadList + "&importId=" + response.importId;  
     		  }else{
     			 window.location.href = BASE_URL + linkUploadList + "?importId=" + response.importId;
     		  }
    	}else{
    	     $('#messageE').removeClass('bg-msg-err');
    	     var messageE = "'#messageE'";
    	     var bg = "'bg-msg-err'";
    		 $('#message-upload-id').html('<div class="alert alert-danger alert-dismissible">'+
					 ' <button aria-hidden="true" data-dismiss="alert" id="btnCloseError" onclick="$('+messageE+').addClass('+bg+');" class="close" type="button">×</button><div >'
					+ response.result +':'+response.exception+'</div></div>');
    	}
    	data.files = null;
      
	},
	fail: function(e,data){
		$('.message-file-upload').remove();
    	$("#message-inprocess").html('<span class="text-center" style="color:red;">'+ 'File upload fail'+'<span/>');
    	$('#message-upload-id').html('<div class="alert alert-danger alert-dismissible">'+
				 ' <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button><div >'
				+ '('+data.result+
	      		' - '+data.textStatus+')'+'</div></div>');
     
    	 $('#btnImport').removeClass('hidden');
    	data.files=null;
  
	}
});

</script>
</body>
</html>